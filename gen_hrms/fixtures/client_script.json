[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Intern Offer",
  "enabled": 1,
  "modified": "2025-09-12 12:43:04.597837",
  "module": "Gen Hrms",
  "name": "Intern Offer Functionality",
  "script": "// Client Script for Offer Letter DocType\n// Add this in: Setup > Client Script\n\nfrappe.ui.form.on('Offer Letter', {\n    refresh: function(frm) {\n        // Add custom buttons in the toolbar\n        if (!frm.doc.__islocal && frm.doc.offer_status !== 'Draft') {\n            frm.add_custom_button(__('Generate PDF'), function() {\n                generate_pdf(frm);\n            }, __('Actions'));\n            \n            frm.add_custom_button(__('Send Email'), function() {\n                send_offer_email(frm);\n            }, __('Actions'));\n        }\n        \n        // Add button to fetch intern details\n        if (frm.doc.intern_application && !frm.doc.intern_name) {\n            frm.add_custom_button(__('Fetch Intern Details'), function() {\n                fetch_intern_details(frm);\n            });\n        }\n    },\n    \n    // Handle the \"Get Intern Details\" button click\n    get_intern_details: function(frm) {\n        fetch_intern_details(frm);\n    },\n    \n    // Handle the \"Generate PDF\" button click  \n    generate_pdf: function(frm) {\n        generate_pdf(frm);\n    },\n    \n    // Handle the \"Send Email\" button click\n    send_email: function(frm) {\n        send_offer_email(frm);\n    },\n    \n    // Auto-fetch details when intern application is selected\n    intern_application: function(frm) {\n        if (frm.doc.intern_application && !frm.doc.intern_name) {\n            frappe.confirm(\n                __('Do you want to fetch intern details from the selected application?'),\n                function() {\n                    fetch_intern_details(frm);\n                }\n            );\n        }\n    },\n    \n    // Calculate duration when dates change\n    start_date: function(frm) {\n        calculate_duration(frm);\n    },\n    \n    end_date: function(frm) {\n        calculate_duration(frm);\n    },\n    \n    // Show/hide stipend field based on paid internship checkbox\n    is_paid_internship: function(frm) {\n        frm.toggle_display('stipend_amount', frm.doc.is_paid_internship);\n        frm.toggle_reqd('stipend_amount', frm.doc.is_paid_internship);\n    }\n});\n\n// Function to generate PDF\nfunction generate_pdf(frm) {\n    if (frm.doc.__islocal) {\n        frappe.msgprint(__('Please save the document first'));\n        return;\n    }\n    \n    frappe.show_alert({\n        message: __('Generating PDF...'),\n        indicator: 'blue'\n    });\n    \n    frappe.call({\n        method: 'generate_offer_pdf',\n        args: {\n            offer_letter_name: frm.doc.name\n        },\n        callback: function(r) {\n            if (r.message) {\n                frm.reload_doc();\n                if (r.message.file_url) {\n                    window.open(r.message.file_url, '_blank');\n                }\n            }\n        },\n        error: function(r) {\n            frappe.show_alert({\n                message: __('Error generating PDF'),\n                indicator: 'red'\n            });\n        }\n    });\n}\n\n// Function to send offer email\nfunction send_offer_email(frm) {\n    if (frm.doc.__islocal) {\n        frappe.msgprint(__('Please save the document first'));\n        return;\n    }\n    \n    if (!frm.doc.intern_email) {\n        frappe.msgprint(__('Intern email is required'));\n        return;\n    }\n    \n    frappe.confirm(\n        __('Are you sure you want to send the offer letter to {0}?', [frm.doc.intern_email]),\n        function() {\n            frappe.show_alert({\n                message: __('Sending email...'),\n                indicator: 'blue'\n            });\n            \n            frappe.call({\n                method: 'send_offer_letter_email',\n                args: {\n                    offer_letter_name: frm.doc.name\n                },\n                callback: function(r) {\n                    if (r.message) {\n                        frm.reload_doc();\n                    }\n                },\n                error: function(r) {\n                    frappe.show_alert({\n                        message: __('Error sending email'),\n                        indicator: 'red'\n                    });\n                }\n            });\n        }\n    );\n}\n\n// Function to fetch intern details\nfunction fetch_intern_details(frm) {\n    if (!frm.doc.intern_application) {\n        frappe.msgprint(__('Please select an Intern Application first'));\n        return;\n    }\n    \n    frappe.show_alert({\n        message: __('Fetching intern details...'),\n        indicator: 'blue'\n    });\n    \n    frappe.call({\n        method: 'fetch_intern_details',\n        args: {\n            offer_letter_name: frm.doc.name\n        },\n        callback: function(r) {\n            if (r.message) {\n                frm.reload_doc();\n            }\n        },\n        error: function(r) {\n            frappe.show_alert({\n                message: __('Error fetching details'),\n                indicator: 'red'\n            });\n        }\n    });\n}\n\n// Function to calculate duration between dates\nfunction calculate_duration(frm) {\n    if (frm.doc.start_date && frm.doc.end_date) {\n        let start = frappe.datetime.str_to_obj(frm.doc.start_date);\n        let end = frappe.datetime.str_to_obj(frm.doc.end_date);\n        \n        if (end > start) {\n            let months = frappe.datetime.get_diff(end, start) / 30;\n            frm.set_value('duration_months', Math.round(months));\n        }\n    }\n}\n\n// Auto-set position title based on department\nfrappe.ui.form.on('Offer Letter', {\n    department: function(frm) {\n        if (frm.doc.department && !frm.doc.position_title) {\n            let title_map = {\n                'Software Development': 'Software Development Intern',\n                'Web Development': 'Web Development Intern', \n                'Mobile App Development': 'Mobile App Development Intern',\n                'Data Science': 'Data Science Intern',\n                'UI/UX Design': 'UI/UX Design Intern',\n                'Digital Marketing': 'Digital Marketing Intern',\n                'Human Resources': 'HR Intern',\n                'Finance': 'Finance Intern',\n                'Operations': 'Operations Intern'\n            };\n            \n            frm.set_value('position_title', title_map[frm.doc.department] || 'Intern');\n        }\n    }\n});",
  "view": "Form"
 }
]